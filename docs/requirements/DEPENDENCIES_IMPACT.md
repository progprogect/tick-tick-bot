# Dependencies Impact Analysis
## Анализ влияния требований на систему

**Версия:** 1.0  
**Дата:** 2024-11-04  
**Статус:** Draft

---

## Назначение

Документ описывает:
- Зависимости между требованиями
- Влияние изменений требований на другие компоненты системы
- Риски и митигации для зависимостей
- План управления зависимостями

---

## Матрица зависимостей требований

### 1. Управление задачами

#### FR-1: Создание задач

**Зависимости:**
- **Зависит от:**
  - FR-10: Распознавание голоса (для голосового ввода)
  - FR-11: Парсинг команд через GPT
  - FR-15: Интеграция с TickTick API
  - FR-16: Интеграция с Telegram Bot API
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-2: Редактирование задач (требует существующую задачу)
- FR-3: Удаление задач (требует существующую задачу)
- FR-4: Перенос задач (требует существующую задачу)
- FR-5: Управление тегами (требует существующую задачу)
- FR-6: Управление заметками (требует существующую задачу)
- FR-7: Повторяющиеся задачи (базируется на создании задач)
- FR-8: Напоминания (требует существующую задачу)
- FR-13: Аналитика рабочего времени (требует задачи для анализа)

**Критичность зависимости**: Высокая  
**Риск**: Если FR-1 не реализован, большинство функций системы недоступны

**Митигация:**
- Реализовать FR-1 в первую очередь (MVP)
- Создать заглушки для тестирования зависимых функций

---

#### FR-2: Редактирование задач

**Зависимости:**
- **Зависит от:**
  - FR-1: Создание задач (требует существующую задачу)
  - FR-11: Парсинг команд через GPT
  - FR-15: Интеграция с TickTick API
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-4: Перенос задач (может использовать редактирование)
- FR-5: Управление тегами (может использовать редактирование)
- FR-6: Управление заметками (может использовать редактирование)

**Критичность зависимости**: Средняя  
**Риск**: Без редактирования пользователи не смогут исправлять ошибки

**Митигация:**
- Реализовать FR-2 в Sprint 1 (MVP)
- Обеспечить возможность удаления и повторного создания задачи как fallback

---

#### FR-3: Удаление задач

**Зависимости:**
- **Зависит от:**
  - FR-1: Создание задач (требует существующую задачу)
  - FR-11: Парсинг команд через GPT
  - FR-15: Интеграция с TickTick API
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-13: Аналитика рабочего времени (удаленные задачи не учитываются)

**Критичность зависимости**: Средняя  
**Риск**: Без удаления пользователи не смогут очищать список задач

**Митигация:**
- Реализовать FR-3 в Sprint 1 (MVP)
- Обеспечить подтверждение удаления для предотвращения случайных удалений

---

#### FR-4: Перенос задач

**Зависимости:**
- **Зависит от:**
  - FR-1: Создание задач (требует существующую задачу)
  - FR-2: Редактирование задач (использует механизм редактирования)
  - FR-11: Парсинг команд через GPT
  - FR-15: Интеграция с TickTick API
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-13: Аналитика рабочего времени (перенос влияет на аналитику по датам)

**Критичность зависимости**: Средняя  
**Риск**: Без переноса пользователи не смогут организовывать задачи по датам

**Митигация:**
- Реализовать FR-4 в Sprint 2
- Обеспечить валидацию дат перед переносом

---

#### FR-5: Управление тегами

**Зависимости:**
- **Зависит от:**
  - FR-1: Создание задач (требует существующую задачу)
  - FR-2: Редактирование задач (использует механизм редактирования)
  - FR-11: Парсинг команд через GPT (особенно для определения срочности)
  - FR-15: Интеграция с TickTick API
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-13: Аналитика рабочего времени (теги могут использоваться для фильтрации)

**Критичность зависимости**: Средняя  
**Риск**: Без тегов пользователи не смогут категоризировать задачи

**Митигация:**
- Реализовать FR-5 в Sprint 2
- Обеспечить автоматическое создание тегов при необходимости

---

#### FR-6: Управление заметками

**Зависимости:**
- **Зависит от:**
  - FR-1: Создание задач (требует существующую задачу)
  - FR-2: Редактирование задач (использует механизм редактирования)
  - FR-11: Парсинг команд через GPT
  - FR-15: Интеграция с TickTick API
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-11: Парсинг команд через GPT (заметки могут использоваться как контекст)

**Критичность зависимости**: Низкая  
**Риск**: Без заметок пользователи не смогут добавлять дополнительную информацию

**Митигация:**
- Реализовать FR-6 в Sprint 2
- Обеспечить возможность добавления заметок при создании задачи

---

#### FR-7: Повторяющиеся задачи

**Зависимости:**
- **Зависит от:**
  - FR-1: Создание задач (базируется на создании задач)
  - FR-11: Парсинг команд через GPT
  - FR-15: Интеграция с TickTick API
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-13: Аналитика рабочего времени (повторяющиеся задачи учитываются в аналитике)

**Критичность зависимости**: Средняя  
**Риск**: Без повторяющихся задач пользователи не смогут автоматизировать регулярные задачи

**Митигация:**
- Реализовать FR-7 в Sprint 2
- Обеспечить валидацию параметров повторения

---

#### FR-8: Напоминания

**Зависимости:**
- **Зависит от:**
  - FR-1: Создание задач (требует существующую задачу)
  - FR-7: Повторяющиеся задачи (может использоваться с повторяющимися задачами)
  - FR-11: Парсинг команд через GPT
  - FR-15: Интеграция с TickTick API
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-13: Аналитика рабочего времени (напоминания не влияют напрямую)

**Критичность зависимости**: Средняя  
**Риск**: Без напоминаний пользователи могут забывать о важных задачах

**Митигация:**
- Реализовать FR-8 в Sprint 2
- Обеспечить валидацию времени напоминания

---

### 2. Обработка команд

#### FR-10: Распознавание голоса

**Зависимости:**
- **Зависит от:**
  - FR-16: Интеграция с Telegram Bot API (для получения голосовых сообщений)
  - FR-17: Интеграция через n8n (для обработки)
  - Внешний сервис: Telegram Speech-to-Text или OpenAI Whisper

**Влияет на:**
- FR-1: Создание задач (через голосовой ввод)
- FR-2: Редактирование задач (через голосовой ввод)
- FR-3: Удаление задач (через голосовой ввод)
- FR-4: Перенос задач (через голосовой ввод)
- Все функции, поддерживающие голосовой ввод

**Критичность зависимости**: Высокая  
**Риск**: Без распознавания голоса недоступен голосовой ввод

**Митигация:**
- Реализовать FR-10 в Sprint 1 (MVP)
- Обеспечить fallback на текстовый ввод при ошибках распознавания
- Использовать кэширование для часто используемых команд

---

#### FR-11: Парсинг команд через GPT

**Зависимости:**
- **Зависит от:**
  - FR-16: Интеграция с Telegram Bot API (для получения команд)
  - FR-17: Интеграция через n8n (для связи с GPT)
  - Внешний сервис: OpenAI API
  - FR-12: Редактирование промпта (для настройки поведения GPT)

**Влияет на:**
- Все функциональные требования (FR-1 - FR-8, FR-13, FR-14)
- Качество понимания команд пользователя

**Критичность зависимости**: Критическая  
**Риск**: Без GPT система не сможет понимать команды пользователя

**Митигация:**
- Реализовать FR-11 в Sprint 1 (MVP)
- Обеспечить оптимизацию промптов для снижения затрат
- Использовать кэширование для похожих команд
- Обеспечить обработку ошибок GPT API
- Создать fallback механизмы для критических команд

---

### 3. Аналитика

#### FR-13: Аналитика рабочего времени

**Зависимости:**
- **Зависит от:**
  - FR-1: Создание задач (требует задачи для анализа)
  - FR-11: Парсинг команд через GPT (для обработки запросов аналитики)
  - FR-15: Интеграция с TickTick API (для получения данных)
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-14: Анализ и оптимизация расписания (базируется на аналитике)

**Критичность зависимости**: Средняя  
**Риск**: Без аналитики пользователи не смогут отслеживать продуктивность

**Митигация:**
- Реализовать FR-13 в Sprint 3
- Обеспечить кэширование результатов аналитики
- Оптимизировать запросы к TickTick API

---

#### FR-14: Анализ и оптимизация расписания

**Зависимости:**
- **Зависит от:**
  - FR-13: Аналитика рабочего времени (базируется на аналитике)
  - FR-11: Парсинг команд через GPT (для анализа и рекомендаций)
  - FR-15: Интеграция с TickTick API (для получения данных)
  - FR-17: Интеграция через n8n

**Влияет на:**
- FR-4: Перенос задач (может рекомендовать перенос)

**Критичность зависимости**: Низкая  
**Риск**: Без оптимизации пользователи не получат рекомендации по улучшению

**Митигация:**
- Реализовать FR-14 в Sprint 3
- Обеспечить валидацию рекомендаций перед применением

---

### 4. Интеграции

#### FR-15: Интеграция с TickTick API

**Зависимости:**
- **Зависит от:**
  - Внешний сервис: TickTick OpenAPI
  - FR-17: Интеграция через n8n (для связи с API)
  - NFR-4: Безопасное хранение токенов

**Влияет на:**
- Все функциональные требования (FR-1 - FR-8, FR-13, FR-14)
- Вся система зависит от TickTick API

**Критичность зависимости**: Критическая  
**Риск**: Без TickTick API система не может работать

**Митигация:**
- Реализовать FR-15 в Sprint 1 (MVP)
- Обеспечить обработку ошибок API
- Использовать версионирование API
- Создать адаптерный слой для абстракции от API
- Обеспечить мониторинг доступности API
- Реализовать retry механизм для временных ошибок

---

#### FR-16: Интеграция с Telegram Bot API

**Зависимости:**
- **Зависит от:**
  - Внешний сервис: Telegram Bot API
  - FR-17: Интеграция через n8n (для связи с API)

**Влияет на:**
- Все функциональные требования (FR-1 - FR-8, FR-13, FR-14)
- Вся система зависит от Telegram Bot API

**Критичность зависимости**: Критическая  
**Риск**: Без Telegram Bot API система не может получать команды и отправлять ответы

**Митигация:**
- Реализовать FR-16 в Sprint 1 (MVP)
- Обеспечить обработку ошибок API
- Обеспечить мониторинг доступности API
- Реализовать retry механизм для временных ошибок

---

#### FR-17: Интеграция через n8n

**Зависимости:**
- **Зависит от:**
  - Внешний сервис: n8n platform
  - FR-15: Интеграция с TickTick API (для связи)
  - FR-16: Интеграция с Telegram Bot API (для связи)
  - FR-11: Парсинг команд через GPT (для связи)

**Влияет на:**
- Все функциональные требования (FR-1 - FR-8, FR-13, FR-14)
- Вся система зависит от n8n

**Критичность зависимости**: Критическая  
**Риск**: Без n8n система не может организовать workflow

**Митигация:**
- Реализовать FR-17 в Sprint 1 (MVP)
- Обеспечить обработку ошибок workflow
- Обеспечить мониторинг workflow
- Реализовать fallback механизмы для критических операций

---

## Граф зависимостей

```
                    ┌─────────────┐
                    │   FR-17     │
                    │  (n8n)      │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │ FR-15   │      │ FR-16   │      │ FR-11   │
   │TickTick │      │Telegram │      │   GPT   │
   └────┬────┘      └────┬────┘      └────┬────┘
        │                 │                 │
        │                 │                 │
        └─────────────────┼─────────────────┘
                          │
                          ▼
        ┌─────────────────────────────────┐
        │         FR-10 (Voice)            │
        └─────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │  FR-1   │      │  FR-2   │      │  FR-3   │
   │ Create  │      │  Edit   │      │ Delete  │
   └────┬────┘      └────┬────┘      └────┬────┘
        │                 │                 │
        └─────────────────┼─────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │  FR-4   │      │  FR-5   │      │  FR-6   │
   │  Move   │      │  Tags   │      │  Notes  │
   └────┬────┘      └────┬────┘      └────┬────┘
        │                 │                 │
        └─────────────────┼─────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │  FR-7   │      │  FR-8   │      │  FR-13  │
   │Recurring│      │Reminders│      │Analytics│
   └────┬────┘      └────┬────┘      └────┬────┘
        │                 │                 │
        └─────────────────┼─────────────────┘
                          │
                          ▼
                   ┌─────────┐
                   │  FR-14  │
                   │Optimize │
                   └─────────┘
```

---

## Критический путь реализации

### Sprint 1 (MVP) - Критический путь

```
FR-17 (n8n) → FR-16 (Telegram) → FR-15 (TickTick) → FR-11 (GPT) → FR-10 (Voice) → FR-1 (Create)
```

**Зависимости:**
- FR-17 должен быть реализован первым (базовая инфраструктура)
- FR-16 и FR-15 могут быть реализованы параллельно
- FR-11 зависит от FR-16 и FR-17
- FR-10 зависит от FR-16 и FR-17
- FR-1 зависит от всех вышеперечисленных

**Риски:**
- Задержка в реализации FR-17 блокирует всю систему
- Задержка в реализации FR-11 блокирует понимание команд

**Митигация:**
- Начать с FR-17 немедленно
- Создать заглушки для тестирования зависимых компонентов
- Реализовать FR-11 с базовым промптом, улучшить позже

---

### Sprint 2 - Расширенные функции

```
FR-1 (Create) → FR-2 (Edit) → FR-3 (Delete) → FR-4 (Move) → FR-5 (Tags) → FR-6 (Notes) → FR-7 (Recurring) → FR-8 (Reminders)
```

**Зависимости:**
- Все функции зависят от FR-1
- FR-2, FR-3, FR-4, FR-5, FR-6 могут быть реализованы параллельно после FR-1
- FR-7 и FR-8 зависят от FR-1

**Риски:**
- Задержка в реализации FR-1 блокирует все остальные функции
- Массовые операции (FR-4, FR-5) требуют дополнительной оптимизации

**Митигация:**
- Реализовать FR-1 в начале Sprint 2
- Реализовать FR-2, FR-3, FR-4, FR-5, FR-6 параллельно
- Оптимизировать массовые операции с использованием батчей

---

### Sprint 3 - Аналитика

```
FR-1 (Create) → FR-13 (Analytics) → FR-14 (Optimize)
```

**Зависимости:**
- FR-13 зависит от FR-1 (требует задачи для анализа)
- FR-14 зависит от FR-13 (базируется на аналитике)

**Риски:**
- Производительность аналитики при большом количестве задач
- Качество рекомендаций GPT

**Митигация:**
- Оптимизировать запросы к TickTick API
- Кэшировать результаты аналитики
- Валидировать рекомендации перед применением

---

## Риски и митигации

### Технические риски

#### RISK-1: Изменения в TickTick API

**Влияние на требования:**
- FR-15: Интеграция с TickTick API
- Все функциональные требования, зависящие от FR-15

**Митигация:**
- Использовать версионирование API
- Создать адаптерный слой для абстракции от API
- Реализовать мониторинг изменений API
- Обеспечить тестирование при обновлениях API

---

#### RISK-2: Ограничения токенов OpenAI

**Влияние на требования:**
- FR-11: Парсинг команд через GPT
- Все функциональные требования, зависящие от FR-11

**Митигация:**
- Оптимизировать промпты для снижения затрат
- Использовать кэширование для похожих команд
- Реализовать rate limiting
- Мониторить использование токенов

---

#### RISK-3: Производительность n8n

**Влияние на требования:**
- FR-17: Интеграция через n8n
- Все функциональные требования, зависящие от FR-17

**Митигация:**
- Оптимизировать workflow в n8n
- Реализовать мониторинг производительности
- Обеспечить масштабирование n8n
- Реализовать кэширование промежуточных результатов

---

#### RISK-4: Ошибки распознавания голоса

**Влияние на требования:**
- FR-10: Распознавание голоса
- Все функциональные требования, поддерживающие голосовой ввод

**Митигация:**
- Обеспечить fallback на текстовый ввод
- Реализовать обработку ошибок распознавания
- Предоставить возможность повторной отправки
- Использовать несколько сервисов распознавания (Telegram + Whisper)

---

### Бизнес-риски

#### RISK-5: Низкое принятие пользователями

**Влияние на требования:**
- Все функциональные требования

**Митигация:**
- Обеспечить простой UX
- Создать качественную документацию
- Предоставить примеры использования
- Реализовать команду `/help` с подсказками

---

#### RISK-6: Сложность поддержки

**Влияние на требования:**
- Все функциональные требования

**Митигация:**
- Следовать лучшим практикам (KISS, DRY, SOLID)
- Обеспечить читаемый и документированный код
- Реализовать логирование для отладки
- Создать архитектуру с низкой связностью

---

## План управления зависимостями

### Приоритизация

1. **Критические зависимости** (Sprint 1):
   - FR-17, FR-16, FR-15, FR-11, FR-10, FR-1

2. **Высокоприоритетные зависимости** (Sprint 1-2):
   - FR-2, FR-3, FR-4

3. **Среднеприоритетные зависимости** (Sprint 2):
   - FR-5, FR-6, FR-7, FR-8

4. **Низкоприоритетные зависимости** (Sprint 3):
   - FR-13, FR-14

### Стратегия тестирования

1. **Unit тесты** для каждого компонента
2. **Integration тесты** для зависимостей между компонентами
3. **E2E тесты** для полных сценариев использования
4. **Моки и заглушки** для внешних зависимостей

### Мониторинг зависимостей

1. **Мониторинг доступности внешних API**
2. **Мониторинг производительности workflow**
3. **Мониторинг использования токенов**
4. **Алерты при ошибках зависимостей**

---

## История изменений

| Версия | Дата | Автор | Описание изменений |
|--------|------|-------|-------------------|
| 1.0 | 2024-11-04 | System Architect | Первоначальная версия Dependencies Impact Analysis |


