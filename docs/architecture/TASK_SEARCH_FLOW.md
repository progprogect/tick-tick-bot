# –î–∞—Ç–∞—Ñ–ª–æ—É –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é

**–î–∞—Ç–∞:** 2024-11-04  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üìä –û–±—â–∏–π –¥–∞—Ç–∞—Ñ–ª–æ—É

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ø–æ—Å—Ç–∞–≤—å –¥–µ–¥–ª–∞–π–Ω –∫ –∑–∞–¥–∞—á–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–≤—Ç—Ä–∞ 8:00"
    ‚Üì
TaskSearchService.find_task_by_title("–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É", project_id=None)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–ê–ì 1: –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ (–µ—Å–ª–∏ use_cache=True)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
    ‚îú‚îÄ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤ –∫—ç—à–µ? ‚îÄ‚îÄ–î–ê‚îÄ‚îÄ‚Üí –í–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É –∏–∑ –∫—ç—à–∞ ‚úÖ
    ‚îÇ
    ‚îî‚îÄ‚Üí –ù–ï–¢
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–ê–ì 2: –ü–æ–∏—Å–∫ –≤ API (–µ—Å–ª–∏ use_api=True)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
    ‚îú‚îÄ‚Üí project_id —É–∫–∞–∑–∞–Ω? ‚îÄ‚îÄ–î–ê‚îÄ‚îÄ‚Üí –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ
    ‚îÇ                                    ‚Üì
    ‚îÇ                            GET /project/{projectId}/data
    ‚îÇ                                    ‚Üì
    ‚îÇ                            –ü–æ–∏—Å–∫ –≤ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö
    ‚îÇ                                    ‚Üì
    ‚îÇ                            –ù–∞–π–¥–µ–Ω–æ? ‚îÄ‚îÄ–î–ê‚îÄ‚îÄ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à ‚Üí –í–µ—Ä–Ω—É—Ç—å ‚úÖ
    ‚îÇ                                    ‚îÇ
    ‚îÇ                                    ‚îî‚îÄ‚Üí –ù–ï–¢ ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
    ‚îÇ
    ‚îî‚îÄ‚Üí –ù–ï–¢ (project_id –Ω–µ —É–∫–∞–∑–∞–Ω)
        ‚Üì
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (–∏–∑ –∫—ç—à–∞ –∏–ª–∏ API)
        ‚Üì
        –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:
            ‚îú‚îÄ‚Üí GET /project/{projectId}/data
            ‚îú‚îÄ‚Üí –ü–æ–∏—Å–∫ –≤ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö
            ‚îú‚îÄ‚Üí –ù–∞–π–¥–µ–Ω–æ? ‚îÄ‚îÄ–î–ê‚îÄ‚îÄ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à ‚Üí –í–µ—Ä–Ω—É—Ç—å ‚úÖ
            ‚îî‚îÄ‚Üí –ù–ï–¢ ‚Üí –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∏—Å–∫ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ
        ‚Üì
        –ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
        ‚Üì
        –í–µ—Ä–Ω—É—Ç—å None ‚ùå
```

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –¥–∞—Ç–∞—Ñ–ª–æ—É

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: project_id —É–∫–∞–∑–∞–Ω

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `title`: "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
- `project_id`: "inbox123456"
- `use_cache`: True
- `use_api`: True

**–®–∞–≥–∏:**

#### –®–∞–≥ 1.1: –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ

```python
# TaskCacheService.get_task_id_by_title()
cache._load_cache()  # –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—ç—à

search_title_normalized = normalize_title("–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"

# –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ
for task_id, task_data in cache._cache.items():
    if task_data.get('status') in ('completed', 'deleted'):
        continue
    
    cached_title_normalized = normalize_title(task_data.get('title', ''))
    
    if cached_title_normalized == search_title_normalized:
        if project_id is None or task_data.get('project_id') == project_id:
            return task_id  # ‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ –∫—ç—à–µ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –≤–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É –∏–∑ –∫—ç—à–∞, –∏–Ω–∞—á–µ ‚Üí –®–∞–≥ 1.2

---

#### –®–∞–≥ 1.2: –ü–æ–∏—Å–∫ –≤ API (—Ç–æ–ª—å–∫–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ)

```python
# TickTickClient.get_tasks(project_id="inbox123456")
response = await client.get(
    endpoint="/open/v1/project/inbox123456/data",
    headers=client._get_headers(),
)

# –û—Ç–≤–µ—Ç:
{
    "project": {...},
    "tasks": [
        {
            "id": "task_123",
            "title": "–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É",
            "projectId": "inbox123456",
            "status": 0,
            ...
        },
        ...
    ]
}

tasks = response.get("tasks", [])  # –¢–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (status=0)
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** `GET /project/{projectId}/data` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (status=0)!

---

#### –®–∞–≥ 1.3: –ü–æ–∏—Å–∫ –≤ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö

```python
search_title_normalized = normalize_title("–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"

# –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
for task in tasks:
    task_title_normalized = normalize_title(task.get("title", ""))
    if task_title_normalized == search_title_normalized:
        # ‚úÖ –ù–∞–π–¥–µ–Ω–æ!
        matching_task = task
        break

# –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
if not matching_task:
    matches = []
    for task in tasks:
        task_title_normalized = normalize_title(task.get("title", ""))
        if (search_title_normalized in task_title_normalized or 
            task_title_normalized in search_title_normalized):
            matches.append((task, len(task_title_normalized)))
    
    if matches:
        # –í—ã–±—Ä–∞—Ç—å —Å–∞–º–æ–µ –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        matches.sort(key=lambda x: x[1], reverse=True)
        matching_task = matches[0][0]  # ‚úÖ –ù–∞–π–¥–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –®–∞–≥ 1.4, –∏–Ω–∞—á–µ ‚Üí –®–∞–≥ 1.5

---

#### –®–∞–≥ 1.4: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à

```python
if matching_task:
    task_id = matching_task.get("id")
    task_title = matching_task.get("title")
    project_id = matching_task.get("projectId")
    
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à –¥–ª—è –±—É–¥—É—â–∏—Ö –ø–æ–∏—Å–∫–æ–≤
    cache.save_task(
        task_id=task_id,
        title=task_title,  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ API
        project_id=project_id,
        status="active",  # status=0 –≤ API = "active" –≤ –∫—ç—à–µ
        tags=matching_task.get("tags", []),
        notes=matching_task.get("content", ""),
        reminders=matching_task.get("reminders", []),
        repeat_flag=matching_task.get("repeatFlag"),
    )
    
    return matching_task  # ‚úÖ –í–µ—Ä–Ω—É—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É
```

---

#### –®–∞–≥ 1.5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (–µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** `GET /project/{projectId}/data` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (status=2).

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑ –∫—ç—à–∞:

```python
# –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑ –∫—ç—à–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
completed_tasks = cache.get_completed_tasks(project_id=project_id)

for task_id, task_project_id in completed_tasks:
    if task_project_id != project_id:
        continue
    
    # –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É –∏–∑ API
    task = await client.get(
        endpoint=f"/open/v1/project/{project_id}/task/{task_id}",
        headers=client._get_headers(),
    )
    
    if task and task.get("status") == 2:  # –ó–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è
        task_title_normalized = normalize_title(task.get("title", ""))
        if task_title_normalized == search_title_normalized:
            # ‚úÖ –ù–∞–π–¥–µ–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞!
            return task
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –≤–µ—Ä–Ω—É—Ç—å, –∏–Ω–∞—á–µ ‚Üí –≤–µ—Ä–Ω—É—Ç—å None

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: project_id –ù–ï —É–∫–∞–∑–∞–Ω

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `title`: "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
- `project_id`: None
- `use_cache`: True
- `use_api`: True

**–®–∞–≥–∏:**

#### –®–∞–≥ 2.1: –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ project_id)

```python
# TaskCacheService.get_task_id_by_title(title, project_id=None)
# –ò—â–µ—Ç –≤–æ –≤—Å–µ—Ö –∑–∞–¥–∞—á–∞—Ö –≤ –∫—ç—à–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –≤–µ—Ä–Ω—É—Ç—å, –∏–Ω–∞—á–µ ‚Üí –®–∞–≥ 2.2

---

#### –®–∞–≥ 2.2: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

```python
# ProjectCacheService.get_projects()
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à –ø—Ä–æ–µ–∫—Ç–æ–≤
if cache._should_refresh():
    # –ö—ç—à —É—Å—Ç–∞—Ä–µ–ª –∏–ª–∏ –ø—É—Å—Ç
    projects = await client.get_projects()  # GET /open/v1/project
    cache._projects = projects
    cache._last_update = datetime.now()
else:
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à
    projects = cache._projects

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# [
#     {"id": "inbox123456", "name": "–†–∞–±–æ—Ç–∞", ...},
#     {"id": "inbox789012", "name": "–õ–∏—á–Ω–æ–µ", ...},
#     ...
# ]
```

---

#### –®–∞–≥ 2.3: –ü–æ–∏—Å–∫ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ

```python
for project in projects:
    project_id = project.get("id")
    project_name = project.get("name")
    
    # –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
    response = await client.get(
        endpoint=f"/open/v1/project/{project_id}/data",
        headers=client._get_headers(),
    )
    
    tasks = response.get("tasks", [])  # –¢–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
    
    # –ü–æ–∏—Å–∫ –≤ –∑–∞–¥–∞—á–∞—Ö
    search_title_normalized = normalize_title("–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É")
    
    matching_task = None
    for task in tasks:
        task_title_normalized = normalize_title(task.get("title", ""))
        if task_title_normalized == search_title_normalized:
            matching_task = task
            break
    
    # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ–µ
    if not matching_task:
        matches = []
        for task in tasks:
            task_title_normalized = normalize_title(task.get("title", ""))
            if (search_title_normalized in task_title_normalized or 
                task_title_normalized in search_title_normalized):
                matches.append((task, len(task_title_normalized)))
        
        if matches:
            matches.sort(key=lambda x: x[1], reverse=True)
            matching_task = matches[0][0]
    
    # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à –∏ –≤–µ—Ä–Ω—É—Ç—å
    if matching_task:
        cache.save_task(
            task_id=matching_task.get("id"),
            title=matching_task.get("title"),
            project_id=matching_task.get("projectId"),
            status="active",
            ...
        )
        return matching_task  # ‚úÖ –ù–∞–π–¥–µ–Ω–æ!

# –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
return None  # ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.

---

## üîß –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π

```python
def normalize_title(title: str) -> str:
    """
    –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    
    –ü—Ä–∞–≤–∏–ª–∞:
    1. –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    2. –£–±—Ä–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
    3. –ó–∞–º–µ–Ω–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –æ–¥–Ω–∏–º –ø—Ä–æ–±–µ–ª–æ–º
    
    –ü—Ä–∏–º–µ—Ä—ã:
    - "–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É" ‚Üí "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
    - "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å  —Ä–∞–±–æ—Ç—É" ‚Üí "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
    - "  –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –†–ê–ë–û–¢–£  " ‚Üí "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
    """
    if not title:
        return ""
    import re
    return re.sub(r'\s+', ' ', title.lower().strip())
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `"–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"` ‚Üí `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"`
- `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å  —Ä–∞–±–æ—Ç—É"` ‚Üí `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"`
- `"  –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –†–ê–ë–û–¢–£  "` ‚Üí `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"`

---

### –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ

```python
def find_partial_match(
    search_title: str,
    tasks: List[Dict[str, Any]]
) -> Optional[Dict[str, Any]]:
    """
    –ù–∞–π—Ç–∏ —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
    
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ª–∏ search_title –≤ task_title
    2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ª–∏ task_title –≤ search_title
    3. –í—ã–±—Ä–∞—Ç—å —Å–∞–º–æ–µ –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ)
    
    –ü—Ä–∏–º–µ—Ä—ã:
    - search_title="–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å" ‚Üí –Ω–∞–π–¥–µ—Ç "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
    - search_title="–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–≤—Ç—Ä–∞" ‚Üí –Ω–∞–π–¥–µ—Ç "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
    """
    search_normalized = normalize_title(search_title)
    matches = []
    
    for task in tasks:
        task_title = task.get("title", "")
        task_normalized = normalize_title(task_title)
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        if (search_normalized in task_normalized or 
            task_normalized in search_normalized):
            matches.append((task, len(task_normalized), task_title))
    
    if matches:
        # –í—ã–±—Ä–∞—Ç—å —Å–∞–º–æ–µ –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ)
        matches.sort(key=lambda x: x[1], reverse=True)
        return matches[0][0]  # –í–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É
    
    return None
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- –ü–æ–∏—Å–∫: `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å"` ‚Üí –ù–∞–π–¥–µ—Ç: `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"`
- –ü–æ–∏—Å–∫: `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–≤—Ç—Ä–∞"` ‚Üí –ù–∞–π–¥–µ—Ç: `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"`
- –ü–æ–∏—Å–∫: `"—Ä–∞–±–æ—Ç–∞"` ‚Üí –ù–∞–π–¥–µ—Ç: `"–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"` (–µ—Å–ª–∏ –Ω–µ—Ç –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)

---

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤

```python
class ProjectCacheService:
    def __init__(self):
        self._projects: List[Dict[str, Any]] = []
        self._last_update: Optional[datetime] = None
        self._cache_ttl: timedelta = timedelta(minutes=5)
    
    async def get_projects(self, force_refresh: bool = False) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
        
        TTL: 5 –º–∏–Ω—É—Ç
        """
        if force_refresh or self._should_refresh():
            # –û–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
            projects = await self.client.get_projects()  # GET /open/v1/project
            self._projects = projects
            self._last_update = datetime.now()
            self.logger.info(f"Projects cache refreshed: {len(projects)} projects")
        
        return self._projects
    
    def _should_refresh(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à"""
        if not self._projects or not self._last_update:
            return True
        return datetime.now() - self._last_update > self._cache_ttl
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API (–∫—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç)
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –¥–∞—Ç–∞—Ñ–ª–æ—É

### –ü—Ä–∏–º–µ—Ä 1: –ó–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫—ç—à–µ

```
–ó–∞–ø—Ä–æ—Å: find_task_by_title("–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É", project_id=None)

–®–∞–≥ 1: –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ
  ‚îú‚îÄ‚Üí normalize_title("–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É") = "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
  ‚îú‚îÄ‚Üí –ü–æ–∏—Å–∫ –≤ cache._cache
  ‚îú‚îÄ‚Üí –ù–∞–π–¥–µ–Ω–æ: task_id="task_123", title="–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É"
  ‚îî‚îÄ‚Üí ‚úÖ –í–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É –∏–∑ –∫—ç—à–∞ (0 API –∑–∞–ø—Ä–æ—Å–æ–≤)
```

**–í—Ä–µ–º—è:** ~1ms (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –∏–∑ –ø–∞–º—è—Ç–∏)

---

### –ü—Ä–∏–º–µ—Ä 2: –ó–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ API (project_id —É–∫–∞–∑–∞–Ω)

```
–ó–∞–ø—Ä–æ—Å: find_task_by_title("–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É", project_id="inbox123456")

–®–∞–≥ 1: –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ
  ‚îî‚îÄ‚Üí –ù–µ –Ω–∞–π–¥–µ–Ω–æ

–®–∞–≥ 2: –ü–æ–∏—Å–∫ –≤ API
  ‚îú‚îÄ‚Üí GET /open/v1/project/inbox123456/data
  ‚îú‚îÄ‚Üí –ü–æ–ª—É—á–µ–Ω–æ 10 –∑–∞–¥–∞—á
  ‚îú‚îÄ‚Üí –ü–æ–∏—Å–∫ –≤ –∑–∞–¥–∞—á–∞—Ö:
  ‚îÇ   ‚îú‚îÄ‚Üí "–ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ" ‚Üí –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
  ‚îÇ   ‚îú‚îÄ‚Üí "–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É" ‚Üí normalize ‚Üí "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É" ‚Üí ‚úÖ –°–û–í–ü–ê–î–ê–ï–¢!
  ‚îÇ   ‚îî‚îÄ‚Üí ...
  ‚îú‚îÄ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à:
  ‚îÇ   ‚îî‚îÄ‚Üí cache.save_task(task_id="task_123", title="–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É", ...)
  ‚îî‚îÄ‚Üí ‚úÖ –í–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É (1 API –∑–∞–ø—Ä–æ—Å)
```

**–í—Ä–µ–º—è:** ~200-500ms (1 API –∑–∞–ø—Ä–æ—Å)

---

### –ü—Ä–∏–º–µ—Ä 3: –ó–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ API (project_id –ù–ï —É–∫–∞–∑–∞–Ω)

```
–ó–∞–ø—Ä–æ—Å: find_task_by_title("–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É", project_id=None)

–®–∞–≥ 1: –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ
  ‚îî‚îÄ‚Üí –ù–µ –Ω–∞–π–¥–µ–Ω–æ

–®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
  ‚îú‚îÄ‚Üí ProjectCacheService.get_projects()
  ‚îú‚îÄ‚Üí –ö—ç—à –ø—Ä–æ–µ–∫—Ç–æ–≤ –∞–∫—Ç—É–∞–ª–µ–Ω? ‚îÄ‚îÄ–î–ê‚îÄ‚îÄ‚Üí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à
  ‚îî‚îÄ‚Üí –ü–æ–ª—É—á–µ–Ω–æ 5 –ø—Ä–æ–µ–∫—Ç–æ–≤

–®–∞–≥ 3: –ü–æ–∏—Å–∫ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ
  ‚îú‚îÄ‚Üí –ü—Ä–æ–µ–∫—Ç 1: "–†–∞–±–æ—Ç–∞" (inbox123456)
  ‚îÇ   ‚îú‚îÄ‚Üí GET /open/v1/project/inbox123456/data
  ‚îÇ   ‚îú‚îÄ‚Üí –ü–æ–ª—É—á–µ–Ω–æ 10 –∑–∞–¥–∞—á
  ‚îÇ   ‚îî‚îÄ‚Üí –ù–µ –Ω–∞–π–¥–µ–Ω–æ
  ‚îÇ
  ‚îú‚îÄ‚Üí –ü—Ä–æ–µ–∫—Ç 2: "–õ–∏—á–Ω–æ–µ" (inbox789012)
  ‚îÇ   ‚îú‚îÄ‚Üí GET /open/v1/project/inbox789012/data
  ‚îÇ   ‚îú‚îÄ‚Üí –ü–æ–ª—É—á–µ–Ω–æ 5 –∑–∞–¥–∞—á
  ‚îÇ   ‚îî‚îÄ‚Üí –ù–µ –Ω–∞–π–¥–µ–Ω–æ
  ‚îÇ
  ‚îú‚îÄ‚Üí –ü—Ä–æ–µ–∫—Ç 3: "–ü–æ–∫—É–ø–∫–∏" (inbox345678)
  ‚îÇ   ‚îú‚îÄ‚Üí GET /open/v1/project/inbox345678/data
  ‚îÇ   ‚îú‚îÄ‚Üí –ü–æ–ª—É—á–µ–Ω–æ 3 –∑–∞–¥–∞—á–∏
  ‚îÇ   ‚îú‚îÄ‚Üí –ü–æ–∏—Å–∫ –≤ –∑–∞–¥–∞—á–∞—Ö:
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚Üí "–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É" ‚Üí normalize ‚Üí "–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É" ‚Üí ‚úÖ –°–û–í–ü–ê–î–ê–ï–¢!
  ‚îÇ   ‚îú‚îÄ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
  ‚îÇ   ‚îî‚îÄ‚Üí ‚úÖ –í–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É (3 API –∑–∞–ø—Ä–æ—Å–∞)
```

**–í—Ä–µ–º—è:** ~600-1500ms (3 API –∑–∞–ø—Ä–æ—Å–∞, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –≤ 3-–º –ø—Ä–æ–µ–∫—Ç–µ)

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.

---

### –ü—Ä–∏–º–µ—Ä 4: –ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

```
–ó–∞–ø—Ä–æ—Å: find_task_by_title("–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∑–∞–¥–∞—á–∞", project_id=None)

–®–∞–≥ 1: –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ
  ‚îî‚îÄ‚Üí –ù–µ –Ω–∞–π–¥–µ–Ω–æ

–®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
  ‚îî‚îÄ‚Üí –ü–æ–ª—É—á–µ–Ω–æ 5 –ø—Ä–æ–µ–∫—Ç–æ–≤

–®–∞–≥ 3: –ü–æ–∏—Å–∫ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ
  ‚îú‚îÄ‚Üí –ü—Ä–æ–µ–∫—Ç 1: –ù–µ –Ω–∞–π–¥–µ–Ω–æ
  ‚îú‚îÄ‚Üí –ü—Ä–æ–µ–∫—Ç 2: –ù–µ –Ω–∞–π–¥–µ–Ω–æ
  ‚îú‚îÄ‚Üí –ü—Ä–æ–µ–∫—Ç 3: –ù–µ –Ω–∞–π–¥–µ–Ω–æ
  ‚îú‚îÄ‚Üí –ü—Ä–æ–µ–∫—Ç 4: –ù–µ –Ω–∞–π–¥–µ–Ω–æ
  ‚îî‚îÄ‚Üí –ü—Ä–æ–µ–∫—Ç 5: –ù–µ –Ω–∞–π–¥–µ–Ω–æ

–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå None (5 API –∑–∞–ø—Ä–æ—Å–æ–≤)
```

**–í—Ä–µ–º—è:** ~1000-2500ms (5 API –∑–∞–ø—Ä–æ—Å–æ–≤)

---

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏

```python
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
for project in projects:
    matching_task = await search_in_project(project, title)
    if matching_task:
        return matching_task  # ‚úÖ –ù–∞–π–¥–µ–Ω–æ, –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ–∏—Å–∫
```

**–≠–∫–æ–Ω–æ–º–∏—è:** –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ –ø–µ—Ä–≤–æ–º –ø—Ä–æ–µ–∫—Ç–µ, –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ.

---

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤

```python
# –ö—ç—à –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞ 5 –º–∏–Ω—É—Ç
# –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
```

**–≠–∫–æ–Ω–æ–º–∏—è:** ~100-200ms –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ (–µ—Å–ª–∏ –∫—ç—à –∞–∫—Ç—É–∞–ª–µ–Ω).

---

### 3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
# –ú–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
import asyncio

tasks = [
    search_in_project(project, title)
    for project in projects
]

results = await asyncio.gather(*tasks)
matching_task = next((r for r in results if r), None)
```

**–≠–∫–æ–Ω–æ–º–∏—è:** –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ = –≤—Ä–µ–º—è —Å–∞–º–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –∞ –Ω–µ —Å—É–º–º–∞ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**‚ö†Ô∏è –û—Å—Ç–æ—Ä–æ–∂–Ω–æ:** –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –±–æ–ª—å—à—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø—Ä–æ–µ–∫—Ç–æ–≤.

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º TaskSearchService

```python
class TaskSearchService:
    async def find_task_by_title(
        self,
        title: str,
        project_id: Optional[str] = None,
        use_cache: bool = True,
        use_api: bool = True,
    ) -> Optional[Dict[str, Any]]:
        """
        –ù–∞–π—Ç–∏ –∑–∞–¥–∞—á—É –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞
        2. –ï—Å–ª–∏ use_cache=True: –ø–æ–∏—Å–∫ –≤ –∫—ç—à–µ
        3. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏ use_api=True:
           - –ï—Å–ª–∏ project_id —É–∫–∞–∑–∞–Ω: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ
           - –ï—Å–ª–∏ project_id –Ω–µ —É–∫–∞–∑–∞–Ω: –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
        4. –ü—Ä–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
        5. –í–µ—Ä–Ω—É—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É –∏–ª–∏ None
        """
        # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
        search_title_normalized = normalize_title(title)
        
        # –®–∞–≥ 1: –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ
        if use_cache:
            task_id = self.cache.get_task_id_by_title(title, project_id)
            if task_id:
                task_data = self.cache.get_task_data(task_id)
                if task_data:
                    # –í–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É –∏–∑ –∫—ç—à–∞
                    return {
                        "id": task_id,
                        "title": task_data.get("title"),
                        "projectId": task_data.get("project_id"),
                        "status": 0 if task_data.get("status") == "active" else 2,
                        ...
                    }
        
        # –®–∞–≥ 2: –ü–æ–∏—Å–∫ –≤ API
        if not use_api:
            return None
        
        if project_id:
            # –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
            return await self._search_in_project(project_id, search_title_normalized, title)
        else:
            # –ü–æ–∏—Å–∫ –≤–æ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
            return await self._search_in_all_projects(search_title_normalized, title)
    
    async def _search_in_project(
        self,
        project_id: str,
        search_title_normalized: str,
        original_title: str,
    ) -> Optional[Dict[str, Any]]:
        """–ü–æ–∏—Å–∫ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ"""
        # GET /open/v1/project/{projectId}/data
        response = await self.client.get(
            endpoint=f"/open/v1/project/{project_id}/data",
            headers=self.client._get_headers(),
        )
        
        tasks = response.get("tasks", [])  # –¢–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
        
        # –ü–æ–∏—Å–∫ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
        matching_task = self._find_exact_match(tasks, search_title_normalized)
        
        # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        if not matching_task:
            matching_task = self._find_partial_match(tasks, search_title_normalized)
        
        # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
        if matching_task:
            self._save_to_cache(matching_task)
            return matching_task
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑ –∫—ç—à–∞
        return await self._check_completed_tasks(project_id, search_title_normalized)
    
    async def _search_in_all_projects(
        self,
        search_title_normalized: str,
        original_title: str,
    ) -> Optional[Dict[str, Any]]:
        """–ü–æ–∏—Å–∫ –≤–æ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö"""
        # –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ (–∏–∑ –∫—ç—à–∞ –∏–ª–∏ API)
        projects = await self.project_cache.get_projects()
        
        # –ü–æ–∏—Å–∫ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ
        for project in projects:
            project_id = project.get("id")
            matching_task = await self._search_in_project(
                project_id,
                search_title_normalized,
                original_title,
            )
            
            if matching_task:
                return matching_task  # ‚úÖ –ù–∞–π–¥–µ–Ω–æ, –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ–∏—Å–∫
        
        return None  # ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ
```

---

## üìù –†–µ–∑—é–º–µ

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π** ‚Äî –µ–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
2. **–î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–∏—Å–∫** ‚Äî —Å–Ω–∞—á–∞–ª–∞ –∫—ç—à, –ø–æ—Ç–æ–º API
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ project_id** ‚Äî –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –∏—â–µ–º —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫—ç—à
5. **–ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ** ‚Äî –µ—Å–ª–∏ —Ç–æ—á–Ω–æ–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –∏—â–µ–º —á–∞—Å—Ç–∏—á–Ω–æ–µ
6. **–ö—ç—à –ø—Ä–æ–µ–∫—Ç–æ–≤** ‚Äî —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- **–ù–∞–π–¥–µ–Ω–æ –≤ –∫—ç—à–µ:** ~1ms (0 API –∑–∞–ø—Ä–æ—Å–æ–≤)
- **–ù–∞–π–¥–µ–Ω–æ –≤ API (project_id —É–∫–∞–∑–∞–Ω):** ~200-500ms (1 API –∑–∞–ø—Ä–æ—Å)
- **–ù–∞–π–¥–µ–Ω–æ –≤ API (project_id –Ω–µ —É–∫–∞–∑–∞–Ω):** ~600-1500ms (N API –∑–∞–ø—Ä–æ—Å–æ–≤, –≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–µ–∫—Ç–æ–≤)
- **–ù–µ –Ω–∞–π–¥–µ–Ω–æ:** ~1000-2500ms (N API –∑–∞–ø—Ä–æ—Å–æ–≤)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024-11-04  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏







